<!DOCTYPE html>
<html>

<head>
    <title>Pixel Painter 2</title>
    <link rel="icon" href="https://github.com/smorebison/PixelPainter2/assets/111925346/ed467d0e-c477-4b7b-9add-13e2611e7f27">
    <link rel="stylesheet" href="styles.css">

    <script>
        let widthInput;
        let heightInput;

        function validDimensions() {
            widthInput = parseInt(document.getElementById("width-input").value);
            heightInput = parseInt(document.getElementById("height-input").value);

            const validWidth = 1 <= widthInput && widthInput <= 16;
            const validHeight = 1 <= heightInput && heightInput <= 16;

            return validWidth && validHeight;
        }

        function convertToPainting() {
            if (!validDimensions()) {
                return;
            }

            const originalImage = document.getElementById("original-image");
            const scaledImage = document.getElementById("painting");
            const canvas = document.createElement("canvas");
            const ctx = canvas.getContext("2d");
            canvas.width = widthInput * 16;
            canvas.height = heightInput * 16;
            ctx.drawImage(originalImage, 0, 0, canvas.width, canvas.height);

            const scaledCanvas = upscaleImage(canvas);
            scaledImage.src = scaledCanvas.toDataURL();
            document.getElementById("download-button").hidden = false;
        }

        function loadImage(event) {
            const input = event.target;
            const reader = new FileReader();

            reader.onload = function () {
                const img = document.getElementById("original-image");
                img.src = reader.result;
                img.onload = function () {
                    if (validDimensions()) {
                        convertToPainting();
                    }
                };
            };
            reader.readAsDataURL(input.files[0]);
        }

        function upscaleImage(canvas) {
            const scaledCanvas = document.createElement("canvas");
            const ctx = scaledCanvas.getContext("2d");

            const scaledWidth = widthInput * 128;
            const scaledHeight = heightInput * 128;

            scaledCanvas.width = scaledWidth;
            scaledCanvas.height = scaledHeight;
            ctx.imageSmoothingEnabled = false;
            ctx.drawImage(canvas, 0, 0, scaledWidth, scaledHeight);

            return scaledCanvas;
        }

        function downloadImage() {
            const img = document.getElementById("painting");

            fetch(img.src)
                .then((response) => response.blob())
                .then((blob) => {
                    const link = document.createElement("a");
                    link.href = URL.createObjectURL(blob);
                    const trimmedFilename = document.getElementById("image-file").files[0].name.replace(/\.[^/.]+$/, "");
                    const imgName =
                        `${trimmedFilename}_${widthInput}x${heightInput}.jpg`;
                    link.download = imgName;
                    link.click();
                });
        }

        function initialize() {
            convertToPainting();
        }
        window.addEventListener("load", initialize);
        
    </script>
</head>

<body>
    <div class="container">
        <h1>Pixel Painter 2</h1>
        <h2>by Blanc</h2>
        <div class="image-input">
            <label for="image-file">Select an Image:</label>
            <input type="file" id="image-file" accept="image/*" onchange="loadImage(event);" />
        </div>
        <h3><b>Select Painting Dimensions (Max of 16):</b></h3>
        <form id="dimension-input" autocomplete="off">
            <div class="input-group">
                <label for="width-input">Block Width:</label>
                <input type="number" id="width-input" min="1" max="16" placeholder="Enter width"
                    onchange="convertToPainting();" />
            </div>
            <div class="input-group">
                <label for="height-input">Block Height:</label>
                <input type="number" id="height-input" min="1" max="16" placeholder="Enter height"
                    onchange="convertToPainting();" />
            </div>
        </form>
        <div class="image-container">
            <div class="image-wrapper">
                <div>
                    <h4>Original Image</h4>
                    <img id="original-image" />
                </div>
                <div>
                    <h4>Painting</h4>
                    <img id="painting" />
                    <div class="button-container">
                        <br>
                        <button onclick="downloadImage()" id="download-button" hidden>Download Painting</button>
                    </div>
                    <br>
                </div>
            </div>
            <canvas id="canvas" style="display: none;"></canvas>
        </div>
    </div>
</body>

</html>
